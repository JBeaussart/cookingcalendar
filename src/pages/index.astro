---
import Layout from "../layouts/Layout.astro";
import { db } from "../firebase";
import { collection, getDocs } from "firebase/firestore";

const daysOfWeek = ["lundi","mardi","mercredi","jeudi","vendredi","samedi","dimanche"];

let recipes = [];
const snapshot = await getDocs(collection(db, "recipes"));
recipes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

const planning = {};
for (const day of daysOfWeek) {
  planning[day] = recipes.find(r => r.day?.toLowerCase() === day) || null;
}
---

<Layout title="Planning">
  <div class="max-w-4xl mx-auto p-4 space-y-6">
    {daysOfWeek.map(day => (
      <div class="p-4 bg-gray-100 rounded-lg shadow">
        <h2 class="text-xl font-semibold capitalize mb-2">{day}</h2>
        {planning[day] ? (
          <div class="p-3 bg-white rounded-md shadow flex items-center justify-between gap-3">
            <span class="font-medium">{planning[day].title}</span>
            <div class="flex items-center gap-3">
              <!-- Icône Voir (œil) -->
              <a href={`/recipes/${planning[day].id}`} title="Voir la recette" class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor"
                    class="w-6 h-6 text-blue-600 hover:text-blue-800 transition">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M2.25 12s3.75-7.5 9.75-7.5S21.75 12 21.75 12s-3.75 7.5-9.75 7.5S2.25 12 2.25 12z" />
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </a>

              <!-- Icône Supprimer (corbeille) -->
              <form method="post" action={`/api/remove-recipe?day=${day}`} class="flex items-center">
                <button type="submit" title="Retirer la recette">
                  <svg xmlns="http://www.w3.org/2000/svg"
                      fill="none" viewBox="0 0 24 24"
                      stroke-width="1.5" stroke="currentColor"
                      class="w-6 h-6 text-red-600 hover:text-red-800 transition">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </form>
            </div>
          </div>
        ) : (
          <a
            href={`/recipes?day=${day}`}
            class="inline-block bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md transition"
          >
            Choisir une recette
          </a>
        )}

      </div>
    ))}
  </div>
</Layout>
