---
import Layout from "../../layouts/Layout.astro";

const recipes = await Astro.glob("../../content/recipes/*.md");
const getSlug = (filePath: string) => filePath.split("/").pop()?.replace(".md", "") ?? "";

const recipeList = recipes.map(r => ({
  slug: getSlug(r.file),
  title: r.frontmatter.title,
  image: r.frontmatter.image || ""
}));
---

<Layout title="Recettes">
  <div class="container mx-auto px-4 py-8">
    <!-- Barre de recherche -->
    <div class="mb-6 flex justify-center">
      <input
        type="text"
        id="searchInput"
        placeholder="Rechercher une recette..."
        class="w-full sm:w-96 border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-green-400"
      >
    </div>

    <!-- Grille des recettes -->
    <div id="recipeGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
      {recipeList.map(r => (
        <a href={`/recipes/${r.slug}`} class="recipe-card bg-white rounded-lg shadow overflow-hidden hover:shadow-lg transition block">
          {r.image && (
            <img src={r.image} alt={r.title} class="w-full h-48 object-cover"/>
          )}
          <div class="p-4">
            <h2 class="font-semibold text-lg mb-2">{r.title}</h2>
          </div>
        </a>
      ))}
    </div>
  </div>

  <script type="module">
    const searchInput = document.getElementById("searchInput");
    const recipeGrid = document.getElementById("recipeGrid");
    const cards = Array.from(recipeGrid.querySelectorAll(".recipe-card"));

    function removeAccents(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    searchInput.addEventListener("input", () => {
      const query = removeAccents(searchInput.value.toLowerCase());
      cards.forEach(card => {
        const title = removeAccents(card.querySelector("h2").textContent.toLowerCase());
        card.style.display = title.includes(query) ? "" : "none";
      });
    });
  </script>
</Layout>
