---
import Layout from "../layouts/Layout.astro";
---
<Layout title="Debug Shopping API">
  <div class="mx-auto max-w-xl p-6 space-y-4">
    <h1 class="text-xl font-bold">Debug /api/save-shopping-totals</h1>

    <div class="flex gap-2">
      <button id="btnGet" class="rounded bg-gray-800 px-3 py-2 text-white">Test GET</button>
      <button id="btnPost" class="rounded bg-blue-600 px-3 py-2 text-white">Test POST (demo items)</button>
    </div>

    <pre id="out" class="rounded border bg-gray-50 p-3 text-xs overflow-auto"></pre>
  </div>

  <script type="module">
    const out = document.getElementById("out");
    const log = (o) => out.textContent = JSON.stringify(o, null, 2);

    document.getElementById("btnGet").addEventListener("click", async () => {
      const r = await fetch("/api/save-shopping-totals", { method: "GET" });
      const j = await r.json().catch(()=> ({}));
      log({ok:r.ok, status:r.status, body:j});
    });

    document.getElementById("btnPost").addEventListener("click", async () => {
      const r = await fetch("/api/save-shopping-totals", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify({
          items: [
            { item: "Œuf", quantity: 6, unit: "pièce", checked: false },
            { item: "Pomme", quantity: 4, unit: "", checked: true }
          ]
        })
      });
      const j = await r.json().catch(()=> ({}));
      log({ok:r.ok, status:r.status, body:j});
    });
  </script>
</Layout>
